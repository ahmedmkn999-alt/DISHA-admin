<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | DISHA ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: white; font-family: 'Cairo'; padding: 0; margin: 0; }
        
        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box { text-align: center; width: 90%; max-width: 300px; }
        .login-input { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #D4AF37; background: #111; color: white; font-size: 1.2rem; text-align: center; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #dashboard { display: none; padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
        
        input, select, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 5px; border: none; font-size: 1rem; box-sizing: border-box; }
        input, select { background: #222; color: white; border: 1px solid #444; }
        button { background: #D4AF37; color: black; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #F4CF57; }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .product-item { background: #151515; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #333; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; }
        .product-item:hover { background: #222; border-color: #D4AF37; }
        
        h2 { color: #D4AF37; border-bottom: 2px solid #D4AF37; padding-bottom: 10px; margin-top: 30px; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Edit Modal) */
        .edit-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: none; justify-content: center; align-items: center; }
        .edit-box { background: #111; padding: 20px; width: 90%; max-width: 400px; border-radius: 10px; border: 1px solid #D4AF37; max-height: 90vh; overflow-y: auto; }
        .edit-img-preview { width: 100px; height: 100px; object-fit: cover; border-radius: 5px; margin: 0 auto 10px auto; display: block; border: 1px solid #555; }
        .close-btn { background: transparent; color: #ccc; border: 1px solid #555; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="loginScreen">
        <div class="login-box">
            <h2 style="border:none;">ğŸ” DISHA ADMIN</h2>
            <input type="password" id="passInput" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="dashboard">
        <h3 style="text-align: center; color: #D4AF37;">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© âš™ï¸</h3>

        <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h2>
        <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <div style="display:flex; gap:5px;">
            <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <input type="number" id="pOld" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…">
        </div>
        <select id="pType">
            <option value="top">Ù‡ÙˆØ¯ÙŠ (Top)</option>
            <option value="bottom">Ø¨Ù†Ø·Ù„ÙˆÙ† (Bottom)</option>
            <option value="track">ØªØ±Ù†Ø¬ (Track)</option>
        </select>
        <input type="text" id="pImgF" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ´">
        <input type="text" id="pImgB" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø¶Ù‡Ø±">
        <button id="addBtn">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>

        <h2>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (<span id="count">0</span>)</h2>
        <p style="font-size:0.8rem; color:#888; text-align:center;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†ØªØ¬ Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø£Ùˆ Ù…Ø³Ø­Ù‡ ğŸ‘‡</p>
        <div id="productsList">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        
        <br>
        <button onclick="logout()" style="background:#c00; color:white;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="editModal" class="edit-modal">
        <div class="edit-box">
            <h3 style="text-align:center; color:#D4AF37; margin-top:0;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ âœï¸</h3>
            
            <img id="ePreview" class="edit-img-preview" src="">
            
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
            <input type="text" id="eName">
            
            <div style="display:flex; gap:5px;">
                <div style="width:50%"><label>Ø§Ù„Ø³Ø¹Ø±:</label><input type="number" id="ePrice"></div>
                <div style="width:50%"><label>Ù‚Ø¯ÙŠÙ…:</label><input type="number" id="eOld"></div>
            </div>

            <label>Ø§Ù„Ù†ÙˆØ¹:</label>
            <select id="eType">
                <option value="top">Ù‡ÙˆØ¯ÙŠ</option>
                <option value="bottom">Ø¨Ù†Ø·Ù„ÙˆÙ†</option>
                <option value="track">ØªØ±Ù†Ø¬</option>
            </select>

            <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„ÙˆØ´):</label>
            <input type="text" id="eImgF" onchange="document.getElementById('ePreview').src=this.value">
            
            <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„Ø¶Ù‡Ø±):</label>
            <input type="text" id="eImgB">

            <button onclick="saveEdit()" style="background:#25D366; color:white;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…</button>
            <button onclick="deleteCurrent()" style="background:#c00; color:white;">Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ ğŸ—‘ï¸</button>
            <button onclick="closeEdit()" class="close-btn">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, orderBy, query } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙŠÙƒ
        const firebaseConfig = {
            apiKey: "AIzaSyAQuVtULU8APTurAmlkQ9gNyFG_N1Jvq48",
            authDomain: "disha-brand.firebaseapp.com",
            projectId: "disha-brand",
            storageBucket: "disha-brand.firebasestorage.app",
            messagingSenderId: "170505241014",
            appId: "1:170505241014:web:b3cbea5dcb06624e93c117",
            measurementId: "G-XL3C1JY6MF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allProducts = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„Ù„Ø³Ø±Ø¹Ø©
        let currentEditId = null; // Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±Ù Ø¨Ù†Ø¹Ø¯Ù„ Ù…ÙŠÙ†

        // ğŸ” Ø§Ù„Ø­Ù…Ø§ÙŠØ©
        window.checkPass = function() {
            if (document.getElementById('passInput').value === "0112838") {
                localStorage.setItem("dishaAdmin", "true");
                showDash();
            } else alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙ„Ø·!");
        }
        function showDash() {
            document.getElementById('loginScreen').style.display='none';
            document.getElementById('dashboard').style.display='block';
            loadProducts();
        }
        if(localStorage.getItem("dishaAdmin")) showDash();
        window.logout = function() { localStorage.removeItem("dishaAdmin"); location.reload(); }

        // â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        document.getElementById('addBtn').addEventListener('click', async () => {
            const n = document.getElementById('pName').value;
            const p = document.getElementById('pPrice').value;
            const t = document.getElementById('pType').value;
            const f = document.getElementById('pImgF').value;
            const b = document.getElementById('pImgB').value;
            
            if(!n || !p || !f) { alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©!"); return; }
            
            document.getElementById('addBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
            await addDoc(collection(db, "products"), {
                n, p:Number(p), o:Number(document.getElementById('pOld').value||0), t, f, b:b||f, date: Date.now()
            });
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!"); 
            document.getElementById('addBtn').innerText = "Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬";
            // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('pName').value = '';
            document.getElementById('pImgF').value = '';
            loadProducts();
        });

        // ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        async function loadProducts() {
            const list = document.getElementById('productsList');
            list.innerHTML = '<p style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            
            const q = query(collection(db, "products"), orderBy("date", "desc"));
            const snap = await getDocs(q);
            
            allProducts = [];
            list.innerHTML = '';
            document.getElementById('count').innerText = snap.size;
            
            snap.forEach(d => {
                const data = d.data();
                data.id = d.id; // Ø­ÙØ¸ Ø§Ù„Ù€ ID
                allProducts.push(data);

                list.innerHTML += `
                    <div class="product-item" onclick="window.openEdit('${d.id}')">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <img src="${data.f}" style="width:40px; height:40px; border-radius:5px; object-fit:cover;">
                            <div>
                                <div style="font-weight:bold; font-size:0.9rem;">${data.n}</div>
                                <div style="font-size:0.8rem; color:#D4AF37;">${data.p} Ø¬.Ù…</div>
                            </div>
                        </div>
                        <div style="font-size:1.2rem;">âœï¸</div>
                    </div>`;
            });
        }

        // âœï¸ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        window.openEdit = (id) => {
            const p = allProducts.find(x => x.id === id);
            if(!p) return;

            currentEditId = id;
            document.getElementById('eName').value = p.n;
            document.getElementById('ePrice').value = p.p;
            document.getElementById('eOld').value = p.o || '';
            document.getElementById('eType').value = p.t;
            document.getElementById('eImgF').value = p.f;
            document.getElementById('eImgB').value = p.b || '';
            document.getElementById('ePreview').src = p.f;

            document.getElementById('editModal').style.display = 'flex';
        }

        // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        window.saveEdit = async () => {
            if(!currentEditId) return;
            const n = document.getElementById('eName').value;
            const p = document.getElementById('ePrice').value;
            const f = document.getElementById('eImgF').value;

            if(!n || !p || !f) { alert("Ù…Ø§ ÙŠÙ†ÙØ¹Ø´ ØªØ³ÙŠØ¨ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø± ÙØ§Ø¶ÙŠ"); return; }

            await updateDoc(doc(db, "products", currentEditId), {
                n: n,
                p: Number(p),
                o: Number(document.getElementById('eOld').value || 0),
                t: document.getElementById('eType').value,
                f: f,
                b: document.getElementById('eImgB').value || f
            });

            alert("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            closeEdit();
            loadProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        }

        // ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
        window.deleteCurrent = async () => {
            if(confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬ Ø¯Ù‡ØŸ Ù…Ø´ Ù‡ÙŠØ±Ø¬Ø¹ ØªØ§Ù†ÙŠ!")) {
                await deleteDoc(doc(db, "products", currentEditId));
                alert("ØªÙ… Ø§Ù„Ø­Ø°Ù");
                closeEdit();
                loadProducts();
            }
        }

        window.closeEdit = () => {
            document.getElementById('editModal').style.display = 'none';
            currentEditId = null;
        }
    </script>
</body>
</html>
